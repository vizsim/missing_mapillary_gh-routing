<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="utf-8" />
  <title>missing_mapillary_gh-routing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="logo.svg" type="image/svg+xml">
  <!-- <link rel='stylesheet' href='https://unpkg.com/maplibre-gl@5.6.0/dist/maplibre-gl.css' /> -->
  <link rel='stylesheet' href='https://unpkg.com/maplibre-gl@5.14.0/dist/maplibre-gl.css' />

  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div id="map"></div>

  <!-- Routing Control Panel -->
  <div class="routing-panel">
    <div class="routing-header">
      <div class="profile-selector">
        <button class="profile-btn active" data-profile="bike_customizable" title="Fahrrad (Anpassbar)">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="5.5" cy="17.5" r="3.5"/>
            <circle cx="18.5" cy="17.5" r="3.5"/>
            <path d="M15 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
            <path d="M12 17.5V14l-3-3 4-3 2 3h3"/>
          </svg>
        </button>
        <button class="profile-btn" data-profile="car_customizable" title="Auto (Anpassbar)">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <!-- Car -->
            <path d="M19.78 9.44L17.94 4.44C17.8238 4.09604 17.6036 3.79671 17.3097 3.5835C17.0159 3.37029 16.663 3.25374 16.3 3.25H7.7C7.3418 3.2508 6.99248 3.36151 6.6992 3.56716C6.40592 3.77281 6.18281 4.06351 6.06 4.4L4.22 9.4C3.92473 9.54131 3.67473 9.76216 3.49808 10.0377C3.32142 10.3133 3.22512 10.6327 3.22 10.96V15.46C3.21426 15.7525 3.28279 16.0417 3.41921 16.3006C3.55562 16.5594 3.75544 16.7794 4 16.94V17V19C4 19.2652 4.10536 19.5196 4.29289 19.7071C4.48043 19.8946 4.73478 20 5 20H6C6.26522 20 6.51957 19.8946 6.70711 19.7071C6.89464 19.5196 7 19.2652 7 19V17.25H17V19C17 19.2652 17.1054 19.5196 17.2929 19.7071C17.4804 19.8946 17.7348 20 18 20H19C19.2652 20 19.5196 19.8946 19.7071 19.7071C19.8946 19.5196 20 19.2652 20 19V17C20 17 20 17 20 16.94C20.2351 16.7808 20.4275 16.5661 20.56 16.315C20.6925 16.0639 20.7612 15.784 20.76 15.5V11C20.7567 10.6748 20.6634 10.3569 20.4904 10.0815C20.3174 9.80616 20.0715 9.58411 19.78 9.44ZM19.25 15.5C19.25 15.5663 19.2237 15.6299 19.1768 15.6768C19.1299 15.7237 19.0663 15.75 19 15.75H5C4.93369 15.75 4.87011 15.7237 4.82322 15.6768C4.77634 15.6299 4.75 15.5663 4.75 15.5V11C4.75 10.9337 4.77634 10.8701 4.82322 10.8232C4.87011 10.7763 4.93369 10.75 5 10.75H19C19.0663 10.75 19.1299 10.7763 19.1768 10.8232C19.2237 10.8701 19.25 10.9337 19.25 11V15.5ZM7.47 4.91C7.48797 4.86341 7.51949 4.82327 7.56048 4.79475C7.60147 4.76624 7.65007 4.75065 7.7 4.75H16.3C16.3499 4.75065 16.3985 4.76624 16.4395 4.79475C16.4805 4.82327 16.512 4.86341 16.53 4.91L17.93 8.75H6.07L7.47 4.91Z"/>
            <path d="M8 14.75C8.82843 14.75 9.5 14.0784 9.5 13.25C9.5 12.4216 8.82843 11.75 8 11.75C7.17157 11.75 6.5 12.4216 6.5 13.25C6.5 14.0784 7.17157 14.75 8 14.75Z"/>
            <path d="M16 14.75C16.8284 14.75 17.5 14.0784 17.5 13.25C17.5 12.4216 16.8284 11.75 16 11.75C15.1716 11.75 14.5 12.4216 14.5 13.25C14.5 14.0784 15.1716 14.75 16 14.75Z"/>
          </svg>
        </button>
      </div>
      <!-- Quick action buttons (visible when collapsed) -->
      <div class="header-quick-actions">
        <button id="set-start-header" class="btn-set-point-header btn-set-start" title="Startpunkt auf Karte setzen">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="#10b981" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
            <g transform="translate(12, 10) scale(0.6) translate(-12, -12)">
              <path d="m9.9 16.97 7.436-7.436a8 8 0 0 0 2.145-3.89l.318-1.401-1.402.317a8 8 0 0 0-3.89 2.146L9.192 12.02m.707 4.95 2.122 3.535c1.178-1.178 2.828-2.828 0-5.657L9.899 16.97zm0 0-2.828-2.829m0 0L3.536 12.02c1.178-1.179 2.828-2.829 5.656 0m-2.12 2.121 2.12-2.121M4.95 16.263s-1.703 2.54-.707 3.536c.995.996 3.535-.707 3.535-.707" fill="white" stroke="white" stroke-width="1.5"/>
            </g>
          </svg>
        </button>
        <button id="set-end-header" class="btn-set-point-header btn-set-end" title="Zielpunkt auf Karte setzen">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="#ef4444" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
            <g transform="translate(12, 10) scale(0.4) translate(-16, -16)">
              <svg width="32" height="32" viewBox="0 0 32 32" fill="none" stroke="white" stroke-miterlimit="10">
                <line x1="6" y1="28" x2="6" y2="5" stroke="white" stroke-width="3" stroke-linecap="round"/>
                <polyline points="6,5 26,5 26,19 6,19" stroke="white" stroke-width="1.5"/>
                <rect x="6" y="5" width="10" height="7" fill="white"/>
                <rect x="16" y="12" width="10" height="7" fill="white"/>
              </svg>
            </g>
          </svg>
        </button>
        <button id="add-waypoint-header" class="btn-add-waypoint-header" title="Zwischenpunkt hinzufügen">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
        </button>
      </div>
      <button class="btn-close" id="collapse-routing-panel" title="Ein-/Ausklappen">
        <svg width="16" height="16" viewBox="-20 -20 490 450" fill="currentColor">
          <g transform="translate(32, 42.666667) rotate(180 225 200)">
            <path d="M246.312928,5.62892705 C252.927596,9.40873724 258.409564,14.8907053 262.189374,21.5053731 L444.667042,340.84129 C456.358134,361.300701 449.250007,387.363834 428.790595,399.054926 C422.34376,402.738832 415.04715,404.676552 407.622001,404.676552 L42.6666667,404.676552 C19.1025173,404.676552 7.10542736e-15,385.574034 7.10542736e-15,362.009885 C7.10542736e-15,354.584736 1.93772021,347.288125 5.62162594,340.84129 L188.099293,21.5053731 C199.790385,1.04596203 225.853517,-6.06216498 246.312928,5.62892705 Z"/>
          </g>
        </svg>
      </button>
    </div>
    
    <div class="routing-content">
      <div class="routing-input-group">
        <div class="input-with-icon">
          <div class="input-icon input-icon-start">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m9.9 16.97 7.436-7.436a8 8 0 0 0 2.145-3.89l.318-1.401-1.402.317a8 8 0 0 0-3.89 2.146L9.192 12.02m.707 4.95 2.122 3.535c1.178-1.178 2.828-2.828 0-5.657L9.899 16.97zm0 0-2.828-2.829m0 0L3.536 12.02c1.178-1.179 2.828-2.829 5.656 0m-2.12 2.121 2.12-2.121M4.95 16.263s-1.703 2.54-.707 3.536c.995.996 3.535-.707 3.535-.707"/>
            </svg>
          </div>
          <div class="input-with-button">
            <input type="text" id="start-input" placeholder="Adresse oder Koordinaten" />
            <button id="set-start" class="btn-set-point btn-set-start" title="Startpunkt auf Karte setzen">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="#10b981" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <g transform="translate(12, 10) scale(0.6) translate(-12, -12)">
                  <path d="m9.9 16.97 7.436-7.436a8 8 0 0 0 2.145-3.89l.318-1.401-1.402.317a8 8 0 0 0-3.89 2.146L9.192 12.02m.707 4.95 2.122 3.535c1.178-1.178 2.828-2.828 0-5.657L9.899 16.97zm0 0-2.828-2.829m0 0L3.536 12.02c1.178-1.179 2.828-2.829 5.656 0m-2.12 2.121 2.12-2.121M4.95 16.263s-1.703 2.54-.707 3.536c.995.996 3.535-.707 3.535-.707" fill="white" stroke="white" stroke-width="1.5"/>
                </g>
              </svg>
            </button>
          </div>
        </div>
      </div>
      
      <div class="routing-input-group">
        <div class="input-with-icon">
          <div class="input-icon input-icon-end">
            <svg width="24" height="24" viewBox="0 0 32 32" fill="none" stroke="#ef4444" stroke-width="2" stroke-miterlimit="10">
              <polyline points="6,28 6,5 26,5 26,19 6,19 "/>
              <!-- 4 Quadrate: diagonal gegenüberliegende haben die gleiche Farbe -->
              <!-- Oben links -->
              <rect x="6" y="5" width="10" height="7" fill="#ef4444"/>
              <!-- Oben rechts -->
              <rect x="16" y="5" width="10" height="7"/>
              <!-- Unten links -->
              <rect x="6" y="12" width="10" height="7"/>
              <!-- Unten rechts -->
              <rect x="16" y="12" width="10" height="7" fill="#ef4444"/>
              <!-- Umrisse für alle Quadrate -->
              <rect x="6" y="5" width="10" height="7"/>
              <rect x="16" y="5" width="10" height="7"/>
              <rect x="6" y="12" width="10" height="7"/>
              <rect x="16" y="12" width="10" height="7"/>
            </svg>
          </div>
          <div class="input-with-button">
            <input type="text" id="end-input" placeholder="Adresse oder Koordinaten" />
            <button id="set-end" class="btn-set-point btn-set-end" title="Zielpunkt auf Karte setzen">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="#ef4444" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <g transform="translate(12, 10) scale(0.4) translate(-16, -16)">
                  <svg width="32" height="32" viewBox="0 0 32 32" fill="none" stroke="white" stroke-miterlimit="10">
                    <line x1="6" y1="28" x2="6" y2="5" stroke="white" stroke-width="3" stroke-linecap="round"/>
                    <polyline points="6,5 26,5 26,19 6,19" stroke="white" stroke-width="1.5"/>
                    <rect x="6" y="5" width="10" height="7" fill="white"/>
                    <rect x="16" y="12" width="10" height="7" fill="white"/>
                  </svg>
                </g>
              </svg>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Waypoints section -->
      <div class="routing-input-group">
        <div class="input-with-icon">
          <div class="input-icon input-icon-waypoint">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="16"></line>
              <line x1="8" y1="12" x2="16" y2="12"></line>
            </svg>
          </div>
          <div class="input-with-button">
            <div class="waypoints-header-field">
              <span>Zwischenpunkte</span>
              <label class="waypoint-optimization-toggle" title="Automatische Optimierung der Reihenfolge aktivieren">
                <input type="checkbox" id="waypoint-optimization-toggle" checked>
                <span class="toggle-label">Auto-Sortierung</span>
              </label>
            </div>
            <button id="add-waypoint" class="btn-add-waypoint" title="Zwischenpunkt hinzufügen">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Waypoints list container -->
      <div id="waypoints-container" class="waypoints-container">
        <div id="waypoints-list" class="waypoints-list"></div>
      </div>
      
      <div class="routing-buttons">
        <button id="calculate-route" class="btn-primary">Route berechnen</button>
        <button id="hide-route" class="btn-icon" title="Ausblenden/Einblenden">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
        </button>
        <button id="export-gpx" class="btn-icon" title="GPX exportieren" style="display: none;">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
        </button>
        <button id="clear-route" class="btn-icon" title="Löschen">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            <line x1="10" y1="11" x2="10" y2="17"></line>
            <line x1="14" y1="11" x2="14" y2="17"></line>
          </svg>
        </button>
      </div>
      
      <div id="customizable-slider-container" class="customizable-slider-container" style="display: none;">
        <div class="slider-section">
          <div class="slider-header">
            <label for="mapillary-priority-slider" class="slider-label">Mapillary Weight:</label>
            <span id="slider-value" class="slider-value">1.0</span>
          </div>
          <input type="range" id="mapillary-priority-slider" class="slider" min="0" max="10" step="1" value="10">
        </div>
        <div id="mapillary-weight-comparison" class="mapillary-weight-comparison" style="display: none;">
          <div class="comparison-divider"></div>
          <div class="comparison-values">
            <div class="comparison-label">
              <span>deltas:</span>
            </div>
            <div class="comparison-item" id="comparison-distance">
              <svg width="14" height="14" viewBox="0 0 179 179" fill="#ec4899">
                <polygon points="52.258,67.769 52.264,37.224 0,89.506 52.264,141.782 52.258,111.237 126.736,111.249 126.736,141.782 179.006,89.506 126.736,37.224 126.736,67.769"/>
              </svg>
              <span class="comparison-text"></span>
            </div>
            <div class="comparison-item" id="comparison-time">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#ec4899" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
              </svg>
              <span class="comparison-text"></span>
            </div>
            <div class="comparison-item" id="comparison-mapillary-distance">
              <div class="comparison-icon-combined">
                <svg width="14" height="14" viewBox="0 0 179 179" fill="#ec4899">
                  <polygon points="52.258,67.769 52.264,37.224 0,89.506 52.264,141.782 52.258,111.237 126.736,111.249 126.736,141.782 179.006,89.506 126.736,37.224 126.736,67.769"/>
                </svg>
                <svg width="9" height="9" viewBox="0 0 24 24" fill="none" stroke="#ec4899" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="comparison-icon-overlay">
                  <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                  <circle cx="12" cy="13" r="4"></circle>
                </svg>
              </div>
              <span class="comparison-text"></span>
            </div>
          </div>
        </div>
        <div id="car-access-container" class="car-access-container" style="display: none;">
          <div class="car-access-wrapper">
            <label class="switch-toggle car-access-switch">
              <input type="checkbox" id="allow-car-access" />
              <span class="switch-slider"></span>
            </label>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="car-access-icon">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M6 1C6.55228 1 7 1.44772 7 2V4H17V2C17 1.44772 17.4477 1 18 1C18.5523 1 19 1.44772 19 2V4H20C21.6569 4 23 5.34315 23 7V11C23 12.6569 21.6569 14 20 14H19V22C19 22.5523 18.5523 23 18 23C17.4477 23 17 22.5523 17 22V14H7L7 22C7 22.5523 6.55228 23 6 23C5.44772 23 5 22.5523 5 22L5 14H4C2.34315 14 1 12.6569 1 11V7C1 5.34315 2.34315 4 4 4H5V2C5 1.44772 5.44772 1 6 1ZM3 7C3 6.44772 3.44772 6 4 6H6.38197L3.4608 11.8423C3.18365 11.6645 3 11.3537 3 11V7ZM5.61803 12H7.38197L10.382 6H8.61803L5.61803 12ZM12.618 6L9.61803 12H11.382L14.382 6H12.618ZM16.618 6L13.618 12H15.382L18.382 6H16.618ZM20.5392 6.15767L17.618 12H20C20.5523 12 21 11.5523 21 11V7C21 6.64628 20.8163 6.33545 20.5392 6.15767Z" fill="currentColor"/>
            </svg>
            <span class="car-access-text">Durchfahrtsbeschränkungen ignorieren</span>
          </div>
        </div>
        <div id="unpaved-roads-container" class="unpaved-roads-container" style="display: none;">
          <div class="unpaved-roads-wrapper">
            <label class="switch-toggle unpaved-roads-switch">
              <input type="checkbox" id="avoid-unpaved-roads" />
              <span class="switch-slider"></span>
            </label>
            <svg width="18" height="18" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" class="unpaved-roads-icon">
              <path d="M42 7.5C42 8.32843 41.3284 9 40.5 9C39.6716 9 39 8.32843 39 7.5C39 6.67157 39.6716 6 40.5 6C41.3284 6 42 6.67157 42 7.5Z" fill="currentColor"/>
              <path d="M42 12.5C42 13.3284 41.3284 14 40.5 14C39.6716 14 39 13.3284 39 12.5C39 11.6716 39.6716 11 40.5 11C41.3284 11 42 11.6716 42 12.5Z" fill="currentColor"/>
              <path d="M42 17.5C42 18.3284 41.3284 19 40.5 19C39.6716 19 39 18.3284 39 17.5C39 16.6716 39.6716 16 40.5 16C41.3284 16 42 16.6716 42 17.5Z" fill="currentColor"/>
              <path d="M41.5 21.3496C41.5 21.9019 41.0523 22.3496 40.5 22.3496C39.9477 22.3496 39.5 21.9019 39.5 21.3496C39.5 20.7973 39.9477 20.3496 40.5 20.3496C41.0523 20.3496 41.5 20.7973 41.5 21.3496Z" fill="currentColor"/>
              <path d="M36.6868 7.92226C36.8029 8.74251 36.2321 9.5016 35.4119 9.61774C34.5916 9.73389 33.8325 9.1631 33.7164 8.34285C33.6003 7.52261 34.171 6.76351 34.9913 6.64737C35.8115 6.53123 36.5706 7.10202 36.6868 7.92226Z" fill="currentColor"/>
              <path d="M37.3879 12.8728C37.5041 13.6931 36.9333 14.4522 36.113 14.5683C35.2928 14.6844 34.5337 14.1137 34.4176 13.2934C34.3014 12.4732 34.8722 11.7141 35.6925 11.5979C36.5127 11.4818 37.2718 12.0526 37.3879 12.8728Z" fill="currentColor"/>
              <path d="M38.0889 17.8235C38.205 18.6438 37.6342 19.4028 36.814 19.519C35.9937 19.6351 35.2346 19.0643 35.1185 18.2441C35.0024 17.4239 35.5731 16.6648 36.3934 16.5486C37.2136 16.4325 37.9727 17.0033 38.0889 17.8235Z" fill="currentColor"/>
              <path d="M38.79 22.7741C38.9062 23.5943 38.3354 24.3534 37.5151 24.4695C36.6949 24.5857 35.9358 24.0149 35.8197 23.1947C35.7035 22.3744 36.2743 21.6153 37.0946 21.4992C37.9148 21.383 38.6739 21.9538 38.79 22.7741Z" fill="currentColor"/>
              <path d="M30.0448 9.63063C30.3844 10.3863 30.0472 11.2741 29.2915 11.6137C28.5359 11.9533 27.6481 11.616 27.3085 10.8604C26.9689 10.1047 27.3062 9.2169 28.0618 8.87731C28.8174 8.53773 29.7053 8.875 30.0448 9.63063Z" fill="currentColor"/>
              <path d="M32.0947 14.1912C32.4342 14.9468 32.097 15.8346 31.3413 16.1742C30.5857 16.5138 29.6979 16.1765 29.3583 15.4209C29.0187 14.6653 29.356 13.7774 30.1116 13.4379C30.8672 13.0983 31.7551 13.4355 32.0947 14.1912Z" fill="currentColor"/>
              <path d="M34.1442 18.7517C34.4838 19.5073 34.1465 20.3952 33.3909 20.7348C32.6353 21.0744 31.7474 20.7371 31.4078 19.9815C31.0683 19.2258 31.4055 18.338 32.1612 17.9984C32.9168 17.6588 33.8046 17.9961 34.1442 18.7517Z" fill="currentColor"/>
              <path d="M35.0767 22.2662C35.3031 22.77 35.0782 23.3619 34.5745 23.5883C34.0707 23.8147 33.4788 23.5898 33.2524 23.0861C33.0261 22.5823 33.2509 21.9904 33.7547 21.764C34.2584 21.5376 34.8503 21.7625 35.0767 22.2662Z" fill="currentColor"/>
              <path d="M23.0252 12.9106C23.5636 13.5403 23.4896 14.4871 22.8599 15.0255C22.2303 15.5638 21.2834 15.4898 20.7451 14.8602C20.2067 14.2305 20.2807 13.2837 20.9103 12.7453C21.54 12.2069 22.4869 12.281 23.0252 12.9106Z" fill="currentColor"/>
              <path d="M26.6485 16.6817C27.1869 17.3114 27.1129 18.2582 26.4832 18.7966C25.8536 19.335 24.9067 19.2609 24.3683 18.6313C23.83 18.0016 23.904 17.0548 24.5336 16.5164C25.1633 15.9781 26.1101 16.0521 26.6485 16.6817Z" fill="currentColor"/>
              <path d="M29.8978 20.482C30.4361 21.1117 30.3621 22.0585 29.7325 22.5969C29.1028 23.1352 28.156 23.0612 27.6176 22.4316C27.0792 21.8019 27.1533 20.8551 27.7829 20.3167C28.4126 19.7784 29.3594 19.8524 29.8978 20.482Z" fill="currentColor"/>
              <path d="M33.147 24.2823C33.6854 24.912 33.6114 25.8588 32.9817 26.3972C32.3521 26.9355 31.4052 26.8615 30.8669 26.2319C30.3285 25.6022 30.4025 24.6554 31.0322 24.117C31.6618 23.5786 32.6087 23.6527 33.147 24.2823Z" fill="currentColor"/>
              <path d="M27.5616 13.6911C27.5616 14.1705 27.1729 14.5591 26.6935 14.5591C26.2141 14.5591 25.8254 14.1705 25.8254 13.6911C25.8254 13.2116 26.2141 12.823 26.6935 12.823C27.1729 12.823 27.5616 13.2116 27.5616 13.6911Z" fill="currentColor"/>
              <path d="M30.1546 18.0338C30.1546 18.5133 29.766 18.9019 29.2865 18.9019C28.8071 18.9019 28.4185 18.5133 28.4185 18.0338C28.4185 17.5544 28.8071 17.1658 29.2865 17.1658C29.766 17.1658 30.1546 17.5544 30.1546 18.0338Z" fill="currentColor"/>
              <path d="M34.5787 15.9211C34.5787 16.4005 34.19 16.7891 33.7106 16.7891C33.2312 16.7891 32.8425 16.4005 32.8425 15.9211C32.8425 15.4416 33.2312 15.053 33.7106 15.053C34.19 15.053 34.5787 15.4416 34.5787 15.9211Z" fill="currentColor"/>
              <path d="M39.3343 15.1321C39.3343 15.6115 38.9456 16.0002 38.4662 16.0002C37.9868 16.0002 37.5981 15.6115 37.5981 15.1321C37.5981 14.6527 37.9868 14.264 38.4662 14.264C38.9456 14.264 39.3343 14.6527 39.3343 15.1321Z" fill="currentColor"/>
              <path d="M33.5777 11.3605C33.5777 11.8399 33.189 12.2286 32.7096 12.2286C32.2302 12.2286 31.8416 11.8399 31.8416 11.3605C31.8416 10.8811 32.2302 10.4924 32.7096 10.4924C33.189 10.4924 33.5777 10.8811 33.5777 11.3605Z" fill="currentColor"/>
              <path d="M39.0001 10.1319C39.0001 10.6113 38.6114 10.9999 38.132 10.9999C37.6526 10.9999 37.2639 10.6113 37.2639 10.1319C37.2639 9.65244 37.6526 9.26379 38.132 9.26379C38.6114 9.26379 39.0001 9.65244 39.0001 10.1319Z" fill="currentColor"/>
              <path fill-rule="evenodd" clip-rule="evenodd" d="M20.7262 12.9584C19.246 14.0427 17.8476 15.2409 16.5442 16.5443C13.2013 19.8872 10.5495 23.8558 8.74037 28.2235C7.18664 31.9746 6.28048 35.9569 6.05557 40.0012C5.99423 41.104 6.89546 42.0002 8.00003 42.0002H22C23.1046 42.0002 23.9885 41.102 24.111 40.0043C24.2983 38.3257 24.7213 36.6784 25.3702 35.1119C26.2748 32.928 27.6007 30.9437 29.2721 29.2722C30.2824 28.2619 31.4071 27.3779 32.621 26.6368C28.8049 22.1902 24.0011 16.6349 20.7262 12.9584ZM25.0957 21.7401L24.3724 22.4306C23.8311 22.9473 23.3105 23.4882 22.8117 24.0515L22.1488 24.8001L20.6515 23.4741L21.3145 22.7255C21.8498 22.121 22.4091 21.5398 22.9913 20.984L23.7146 20.2935L25.0957 21.7401ZM20.6432 26.8087L20.1082 27.6536C19.3092 28.9155 18.6018 30.2488 17.9938 31.6398L17.5932 32.5561L15.7607 31.755L16.1612 30.8387C16.8093 29.356 17.5643 27.9327 18.4184 26.5836L18.9534 25.7388L20.6432 26.8087ZM16.7566 34.9367L16.4947 35.9018C16.298 36.6263 16.1266 37.3612 15.9815 38.1046L15.7898 39.0861L13.8269 38.7029L14.0185 37.7214C14.1729 36.9306 14.3552 36.1489 14.5645 35.3779L14.8265 34.4128L16.7566 34.9367Z" fill="currentColor"/>
            </svg>
            <span class="unpaved-roads-text">Unbefestigte Wege meiden</span>
          </div>
        </div>
        <div id="avoid-pushing-container" class="avoid-pushing-container" style="display: none;">
          <div class="avoid-pushing-wrapper">
            <label class="switch-toggle avoid-pushing-switch">
              <input type="checkbox" id="avoid-pushing" />
              <span class="switch-slider"></span>
            </label>
            <svg width="18" height="18" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg" class="avoid-pushing-icon">
              <!-- Person schiebt Fahrrad -->
              <path d="M 103.59,38.09 C 98.49,38.27 93.57,40.9 90.67,45.55 L 63.58,88.88 C 58.8,90 54.85,93.57 53.35,98.42 L 43.14,131.39 C 26.76,128.06 10.3,136.74 3.79,152.13 C -3.78,170.01 4.58,190.63 22.46,198.2 C 40.33,205.76 60.96,197.41 68.52,179.53 C 76.09,161.66 67.73,141.03 49.85,133.47 L 52.65,124.44 L 84.29,159.55 V 149.05 L 55.06,116.63 H 84.28 V 109.6 H 67.03 57.24 L 60.06,100.5 C 60.19,100.07 60.37,99.67 60.58,99.28 C 61.02,103.38 63.26,107.25 67.03,109.6 L 88.25,75.66 V 105.64 H 120.03 V 53.98 C 120.03,48.49 117.21,43.4 112.57,40.49 C 109.78,38.75 106.65,37.98 103.59,38.09 Z M 36.32,137.71 C 37.88,137.72 39.46,137.86 41.04,138.14 L 32.8,164.78 C 32.22,166.64 33.26,168.61 35.11,169.19 C 36.97,169.76 38.94,168.72 39.51,166.87 L 47.76,140.22 C 61.9,146.63 68.17,163.29 61.76,177.43 C 55.35,191.58 38.69,197.84 24.55,191.44 C 10.41,185.03 4.14,168.37 10.55,154.23 C 15.19,144 25.38,137.65 36.32,137.71 Z" fill="currentColor"/>
              <path d="M 153.49,170.95 C 153.96,170.04 154.04,168.93 153.58,167.91 L 140.62,138.88 C 140.94,138.78 141.27,138.69 141.6,138.61 C 156.63,134.73 171.97,143.77 175.85,158.81 C 179.73,173.85 170.69,189.19 155.66,193.07 C 140.62,196.95 125.28,187.91 121.4,172.87 H 126.58 L 122.19,165.85 H 120.5 C 120.5,165.01 120.55,164.18 120.63,163.35 L 115.27,154.79 C 114.1,158.31 113.47,162.03 113.47,165.85 H 108.09 V 172.87 H 114.18 C 114.45,174.19 114.79,175.48 115.2,176.74 C 121.22,195.2 141.06,205.28 159.51,199.26 C 177.97,193.25 188.05,173.41 182.03,154.95 C 176.01,136.49 156.17,126.41 137.72,132.43 L 127.52,109.61 L 130.16,102.58 H 138.07 V 95.56 H 123.98 V 119.06 L 131.26,135.34 C 131.23,135.36 131.2,135.38 131.17,135.4 Z" fill="currentColor"/>
              <path d="M 144.39,165.83 H 126.86 L 131.25,172.86 H 148.56 Z" fill="currentColor"/>
              <path d="M 127.62,137.66 C 123.14,141 119.56,145.33 117.12,150.25 L 121.74,157.63 C 123.41,152.18 126.7,147.31 131.24,143.74 Z" fill="currentColor"/>
              <path d="M 120.03,109.6 H 88.25 V 116.63 H 117.39 L 109.41,137.91 L 114.1,145.42 L 121.11,126.73 L 120.03,124.91 Z" fill="currentColor"/>
              <path d="M 88.25,109.6 V 200.99 C 97.02,200.99 104.13,193.86 104.13,185.09 V 129.46 L 143.86,193.04 C 151.31,188.38 153.57,178.58 148.93,171.14 L 120.03,124.9 V 109.6" fill="currentColor"/>
              <circle cx="94.2" cy="16.23" r="15.89" fill="currentColor"/>
            </svg>
            <span class="avoid-pushing-text">Schieben verhindern</span>
          </div>
        </div>
      </div>
      
      <div id="route-info" class="route-info"></div>
      <div id="heightgraph-container" class="heightgraph-container" style="display: none;">
        <div class="heightgraph-header">
          <span>Höhenprofil</span>
          <select id="heightgraph-encoded-select" class="heightgraph-select">
            <option value="mapillary_coverage">Mapillary Coverage</option>
            <option value="surface">Surface</option>
            <option value="road_class">Road Class</option>
            <option value="bicycle_infra">Bicycle Infrastructure</option>
          </select>
        </div>
        <div style="position: relative;">
          <canvas id="heightgraph-canvas"></canvas>
          <canvas id="heightgraph-indicator-canvas" style="position: absolute; top: 0; left: 0; pointer-events: none;"></canvas>
        </div>
        <div id="heightgraph-stats" class="heightgraph-stats"></div>
      </div>
      
      <div class="github-links">
        <img src="https://img.shields.io/badge/Status-Experimental-red" alt="Status: Experimental" class="status-badge">
        <div style="flex: 1;"></div>
        <a href="https://github.com/vizsim/missing_mapillary_gh-routing" target="_blank" rel="noopener noreferrer" 
           title="GitHub Repository" 
           class="github-link">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
          </svg>
        </a>
        <a href="https://github.com/vizsim/missing_mapillary_gh-routing/issues" target="_blank" rel="noopener noreferrer" 
           title="Fehler melden oder Feedback geben"
           class="github-link">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M8 9.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z"/>
            <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Z"/>
          </svg>
          <span>Issues</span>
        </a>
      </div>
    </div>
  </div>

  <!-- Context Panel: Combined -->
  <div class="context-panel">
    <div class="context-header">
      <div class="context-title">
        <span>Kontext-Layer</span>
      </div>
      <button class="btn-close" id="collapse-context-panel" title="Ein-/Ausklappen">
        <svg width="16" height="16" viewBox="-20 -20 490 450" fill="currentColor">
          <g transform="translate(32, 42.666667) rotate(180 225 200)">
            <path d="M246.312928,5.62892705 C252.927596,9.40873724 258.409564,14.8907053 262.189374,21.5053731 L444.667042,340.84129 C456.358134,361.300701 449.250007,387.363834 428.790595,399.054926 C422.34376,402.738832 415.04715,404.676552 407.622001,404.676552 L42.6666667,404.676552 C19.1025173,404.676552 7.10542736e-15,385.574034 7.10542736e-15,362.009885 C7.10542736e-15,354.584736 1.93772021,347.288125 5.62162594,340.84129 L188.099293,21.5053731 C199.790385,1.04596203 225.853517,-6.06216498 246.312928,5.62892705 Z"/>
          </g>
        </svg>
      </button>
    </div>
    
    <div class="context-content">
      <!-- Missing Streets Segment -->
      <div class="context-segment">
        <div class="context-segment-header" id="toggle-missing-streets-segment">
          <div class="context-segment-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="context-icon">
              <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
              <circle cx="12" cy="13" r="4"></circle>
            </svg>
            <span>Straßensegmente mit...</span>
            <span class="info-icon-small" title="Quelle: OSM Mapillary Missing Streets; tilda-geo.de">ⓘ</span>
          </div>
          <label class="switch-toggle">
            <input type="checkbox" id="toggle-missing-streets" />
            <span class="switch-slider"></span>
          </label>
        </div>
        
        <div class="context-segment-content collapsed" id="missing-streets-segment-content">
          <div class="bikelanes-legend" id="missing-streets-legend">
            <div class="legend-item">
              <span class="legend-line solid" style="background: #174ed9;"></span>
              <span class="legend-text">...ausreichend Panorama-Fotos</span>
            </div>
            <div class="legend-item">
              <span class="legend-line solid" style="background: #0098f0;"></span>
              <span class="legend-text">...ausreichend regulären Fotos</span>
            </div>
            <div class="legend-item">
              <span class="legend-line solid" style="background: #e91e63;"></span>
              <span class="legend-text">...fehlenden Fotos</span>
            </div>
            
            <div class="context-footer">
              <span>Mehr auf 
                <a id="osm-verkehrswende-link" href="https://www.osm-verkehrswende.org/mapillary/map/" target="_blank" rel="noopener">osm-verkehrswende.org</a>
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Bike Lanes Segment -->
      <div class="context-segment">
        <div class="context-segment-header" id="toggle-bikelanes-segment">
          <div class="context-segment-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="context-icon">
              <circle cx="5.5" cy="17.5" r="3.5"/>
              <circle cx="18.5" cy="17.5" r="3.5"/>
              <path d="M15 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
              <path d="M12 17.5V14l-3-3 4-3 2 3h3"/>
            </svg>
            <span>Radinfrastruktur</span>
            <span class="info-icon-small" title="Quelle: © OpenStreetMap; tilda-geo.de">ⓘ</span>
          </div>
          <label class="switch-toggle">
            <input type="checkbox" id="toggle-bikelanes" />
            <span class="switch-slider"></span>
          </label>
        </div>
        
        <div class="context-segment-content collapsed" id="bikelanes-segment-content">
          <div class="bikelanes-legend" id="bikelanes-legend">
            <div class="legend-item">
              <span class="legend-line solid" style="background: #174ed9;"></span>
              <span class="legend-text">Führung baul. abgesetzt von Kfz</span>
            </div>
            <div class="legend-item">
              <span class="legend-line solid" style="background: #0098f0;"></span>
              <span class="legend-text">Führung eigenständig auf Fahrbahn</span>
            </div>
            <div class="legend-item">
              <span class="legend-line dashed" style="--line-color: #174ed9;"></span>
              <span class="legend-text">Führung mit Fußverkehr</span>
            </div>
            <div class="legend-item">
              <span class="legend-line dashed" style="--line-color: #9fb9f9;"></span>
              <span class="legend-text">Fußverkehr mit Rad frei</span>
            </div>
            <div class="legend-item">
              <span class="legend-line dashed" style="--line-color: #0098f0;"></span>
              <span class="legend-text">Führung mit Kfz (explizit)</span>
            </div>
            <div class="legend-item">
              <span class="legend-line dashed" style="--line-color: #a97bea;"></span>
              <span class="legend-text">Führungsform unklar</span>
            </div>
            
            <div class="context-footer">
              <span>Mehr auf 
                <a id="radinfra-link" href="https://tilda-geo.de/regionen/radinfra" target="_blank" rel="noopener">radinfra.de</a>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Left UI Container -->
  <div id="bottom-left-ui-container">
    <div id="custom-nav-control-wrapper">
      <!-- Dark Mode Toggle -->
      <button id="dark-mode-toggle" class="map-settings-btn" title="Dark Mode umschalten">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
      </button>
    <div id="custom-nav-control"></div>
    </div>

    <!-- Map Settings Menu -->
    <div id="map-settings-menu">
      <button id="map-settings-toggle" class="map-settings-btn" title="Karten-Einstellungen">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" fill-rule="nonzero">
          <path d="M20.0256266,12.1919251 C19.8772338,12.4293536 19.6806426,12.6329794 19.4485757,12.7896246 L13.3986821,16.8733027 C12.5534904,17.4438072 11.4465096,17.4438072 10.6013179,16.8733027 L4.55142428,12.7896246 C3.79043588,12.2759574 3.49533538,11.3303569 3.77229147,10.5 L10.6132495,15.0595795 C11.4005138,15.5844224 12.4112447,15.617225 13.2264422,15.1579876 L13.3867505,15.0595795 L20.2270621,10.4994959 C20.4087649,11.0456562 20.3545192,11.665697 20.0256266,12.1919251 Z M20.2270621,13.7494959 C20.4087649,14.2956562 20.3545192,14.915697 20.0256266,15.4419251 C19.8772338,15.6793536 19.6806426,15.8829794 19.4485757,16.0396246 L13.3986821,20.1233027 C12.5534904,20.6938072 11.4465096,20.6938072 10.6013179,20.1233027 L4.55142428,16.0396246 C3.79043588,15.5259574 3.49533538,14.5803569 3.77229147,13.75 L10.6132495,18.3095795 C11.4005138,18.8344224 12.4112447,18.867225 13.2264422,18.4079876 L13.3867505,18.3095795 L20.2270621,13.7494959 Z M13.3867505,3.42450033 L19.7519246,7.66794971 C20.2114532,7.97430216 20.3356271,8.59517151 20.0292747,9.0547002 C19.9560398,9.16455248 19.8617768,9.25881544 19.7519246,9.33205029 L13.3867505,13.5754997 C12.547002,14.135332 11.452998,14.135332 10.6132495,13.5754997 L4.24807544,9.33205029 C3.78854675,9.02569784 3.66437288,8.40482849 3.97072534,7.9452998 C4.0439602,7.83544752 4.13822315,7.74118456 4.24807544,7.66794971 L10.6132495,3.42450033 C11.452998,2.86466797 12.547002,2.86466797 13.3867505,3.42450033 Z M11.560754,4.60622527 L11.4452998,4.67257577 L5.705,8.5 L11.4452998,12.3274242 C11.7438771,12.5264757 12.1228116,12.5485926 12.439246,12.3937747 L12.5547002,12.3274242 L18.294,8.5 L12.5547002,4.67257577 C12.2561229,4.47352427 11.8771884,4.45140743 11.560754,4.60622527 Z"/>
        </svg>
      </button>
      
      <div id="map-settings-panel" class="map-settings-panel hidden">
        <div class="map-settings-section">
          <div class="map-settings-label">Kartenstil</div>
          <div class="basemap-buttons">
            <button class="basemap-btn" data-map="standard" title="Standard"></button>
            <button class="basemap-btn" data-map="dark" title="Dark"></button>
            <button class="basemap-btn" data-map="osm" title="OpenStreetMap"></button>
            <button class="basemap-btn" data-map="satellite" title="Satellit"></button>
          </div>
        </div>
        
        <div class="map-settings-divider"></div>
        
        <div class="map-settings-section">
          <div class="map-settings-label">Ansicht</div>
          <div class="switch-control">
            <div class="switch-label" title="Mapterhorn Terrain Daten">
              <span>Terrain</span>
              <label class="switch">
                <input type="checkbox" id="toggleTerrain" />
                <span class="switch-slider"></span>
              </label>
            </div>
            <div class="switch-label" title="Mapterhorn Hillshade Daten">
              <span>Hillshade</span>
              <label class="switch">
                <input type="checkbox" id="toggleHillshade" />
                <span class="switch-slider"></span>
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Waypoint Context Menu -->
  <div id="waypoint-context-menu" class="waypoint-context-menu hidden">
    <div class="waypoint-context-menu-item" id="waypoint-context-menu-delete">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        <line x1="10" y1="11" x2="10" y2="17"></line>
        <line x1="14" y1="11" x2="14" y2="17"></line>
      </svg>
      <span>Löschen</span>
    </div>
  </div>

  <!-- Context Menu -->
  <div id="context-menu" class="context-menu hidden">
    <div class="context-menu-item" id="context-menu-set-start">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" fill="#10b981"></path>
        <g transform="translate(12, 10) scale(0.6) translate(-12, -12)">
          <path d="m9.9 16.97 7.436-7.436a8 8 0 0 0 2.145-3.89l.318-1.401-1.402.317a8 8 0 0 0-3.89 2.146L9.192 12.02m.707 4.95 2.122 3.535c1.178-1.178 2.828-2.828 0-5.657L9.899 16.97zm0 0-2.828-2.829m0 0L3.536 12.02c1.178-1.179 2.828-2.829 5.656 0m-2.12 2.121 2.12-2.121M4.95 16.263s-1.703 2.54-.707 3.536c.995.996 3.535-.707 3.535-.707" fill="white" stroke="white" stroke-width="1.5"/>
        </g>
      </svg>
      <span>Startpunkt setzen</span>
    </div>
    <div class="context-menu-item" id="context-menu-set-end">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" fill="#ef4444"></path>
        <g transform="translate(12, 10) scale(0.4) translate(-16, -16)">
          <svg width="32" height="32" viewBox="0 0 32 32" fill="none" stroke="white" stroke-miterlimit="10">
            <line x1="6" y1="28" x2="6" y2="5" stroke="white" stroke-width="3" stroke-linecap="round"/>
            <polyline points="6,5 26,5 26,19 6,19" stroke="white" stroke-width="1.5"/>
            <rect x="6" y="5" width="10" height="7" fill="white"/>
            <rect x="16" y="12" width="10" height="7" fill="white"/>
          </svg>
        </g>
      </svg>
      <span>Zielpunkt setzen</span>
    </div>
    <div class="context-menu-item" id="context-menu-set-waypoint">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="16"></line>
        <line x1="8" y1="12" x2="16" y2="12"></line>
      </svg>
      <span>Zwischenpunkt setzen</span>
    </div>
    <div class="context-menu-separator"></div>
    <a class="context-menu-item" id="context-menu-osm-query" target="_blank" rel="noopener noreferrer">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="16" x2="12" y2="12"></line>
        <line x1="12" y1="8" x2="12.01" y2="8"></line>
      </svg>
      <span>OSM Objektabfrage</span>
    </a>
    <a class="context-menu-item" id="context-menu-mapillary" target="_blank" rel="noopener noreferrer">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
        <circle cx="12" cy="13" r="4"></circle>
      </svg>
      <span>zu Mapillary</span>
    </a>
  </div>

  <!-- Attribution Footer
  <div id="attribution-footer" style="position: absolute; bottom: 80px; left: 10px; background: rgba(255, 255, 255, 0.9); padding: 8px 12px; border-radius: 4px; font-size: 11px; z-index: 1; font-family: sans-serif; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    Höhenmodelle: <a href="https://sonny.4lima.de" target="_blank" rel="noopener">Sonny</a> (CC BY 4.0)
  </div> -->

  <!-- <script src="https://unpkg.com/maplibre-gl@5.9.0/dist/maplibre-gl.js" crossorigin="anonymous"></script> -->
  <script src="https://unpkg.com/maplibre-gl@5.14.0/dist/maplibre-gl.js" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/pmtiles@4.3.0/dist/pmtiles.js"></script>
  <!-- Initialize dark mode early -->
  <script>
    // Initialize theme based on manual override or system preference
    (function() {
      const themeOverride = localStorage.getItem('theme-override');
      
      if (themeOverride === 'dark') {
        document.documentElement.setAttribute('data-theme', 'dark');
      } else if (themeOverride === 'light') {
        document.documentElement.setAttribute('data-theme', 'light');
      } else {
        // No manual override - let CSS media query handle it
        // Don't set data-theme, so @media (prefers-color-scheme: dark) can work
        document.documentElement.removeAttribute('data-theme');
      }
    })();
  </script>
  <script type="module" src="./main.js"></script>
</body>

</html>
